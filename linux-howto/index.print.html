<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.108.0">
    <meta name="generator" content="Relearn 5.9.4+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="Exploit writeups, info sec articles..">
    <meta name="author" content="solc0nf">
    <title>Linux How To :: solc0nf</title>
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/css/fontawesome-all.min.css?1690804204" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fontawesome-all.min.css?1690804204" rel="stylesheet"></noscript>
    <link href="/css/featherlight.min.css?1690804204" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/featherlight.min.css?1690804204" rel="stylesheet"></noscript>
    <link href="/css/auto-complete.css?1690804204" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/auto-complete.css?1690804204" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar.min.css?1690804204" rel="stylesheet">
    <link href="/css/nucleus.css?1690804204" rel="stylesheet">
    <link href="/css/fonts.css?1690804204" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fonts.css?1690804204" rel="stylesheet"></noscript>
    <link href="/css/theme.css?1690804204" rel="stylesheet">
    <link href="/css/theme-relearn-dark.css?1690804204" rel="stylesheet" id="variant-style">
    <link href="/css/ie.css?1690804204" rel="stylesheet">
    <link href="/css/variant.css?1690804204" rel="stylesheet">
    <link href="/css/print.css?1690804204" rel="stylesheet" media="print">
    <link href="/css/format-print.css?1690804204" rel="stylesheet">
    <script src="/js/url.js?1690804204"></script>
    <script src="/js/variant.js?1690804204"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="/index.search.js";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/solc0nf.github.io/';
      window.variants && variants.init( [ 'relearn-dark' ] );
    </script>
    <script src="/js/jquery.min.js?1690804204" defer></script>
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="/linux-howto/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable" dir="ltr">
        <div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/index.html"><span itemprop="name">solc0nf</span></a><meta itemprop="position" content="1"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Linux How To</span><meta itemprop="position" content="2"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="default">
<h1 id="linux-how-to">Linux How To</h1>

<ul>
<li>Generate secure passwords in Linux <a href="/linux-howto/index.html/secure-passwords-in-linux">Click here</a></li>
<li>Encrypt and Share Files With GPG <a href="/linux-howto/index.html/encrypt-and-share-files-with-gpg">Click here</a></li>
<li>Apache2 Custom Site With Self Signed Certificate <a href="/linux-howto/index.html/apache2-custom-site-with-self-signed-certificate">Click here</a></li>
</ul>

            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Linux How To</h1>
          <article class="default">
<h1 id="apache2-custom-site-with-self-signed-certificate">Apache2 Custom Site With Self Signed Certificate</h1>

<p>For this activity, we will use a Debian 12 VM with apache installed. The debian installer gives us an option to install a web server (among other things) during the installation process. In case we need to install apache2 after the machine has booted up, it can be done with <code>apt install apache2</code>.</p>
<p>Either way, once you have apache installed, we can go to <code>http://your_server_ip</code> and we&rsquo;ll get the default apache landing page as show inthe screen grab below.</p>
<p>
<a href="/images/default_apache_landing_page_2023-07-31_09-54.png" data-featherlight="image">
<img src="/images/default_apache_landing_page_2023-07-31_09-54.png" alt="Default apache Landing Page" style="height: auto; width: auto;" loading="lazy">
</a></p>
<p><strong>Our task here is to host a sample site on the machine and enable access to it via <code>https://server_ip</code></strong>.</p>
<p>By default, <code>/var/www/html</code> is the document root directory (web root) for apache. This is the main directory where apache looks for files to serve to clients requesting them.</p>
<h4 id="creating-our-website">Creating our website</h4>
<p>We will start with creating a directory for our site under <code>var/www/</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo mkdir /var/www/oursamplesite
</span></span></code></pre></div><p>If we do a directory listing with <code>ls -l /var/www</code>, we can see that our newly created directory is owned by root, as show in the screen grab below.</p>
<p>
<a href="/images/ls-l_2023-07-31_10-11.png" data-featherlight="image">
<img src="/images/ls-l_2023-07-31_10-11.png" alt="ls -la /var/www" style="height: auto; width: auto;" loading="lazy">
</a></p>
<p>We need to change the ownership of this directory to www-data. www-data is the usr that apache use by default for normal operation. Apache can access any file/directory that www-data can access. We can change the owneship of the newly created directory with the command</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo chown -R www-data:www-data /var/www/oursamplesite
</span></span></code></pre></div><p>Now that we have the directory ownership changed, we will add our current user <em>havoc</em> to the www-data group with the command</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo usermod -aG www-data havoc
</span></span></code></pre></div><p>Now we need to set persmissions for apache and havoc to write and read files in the newly created directoy. This is accomplished with the following command</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo chmod -R <span style="color:#ae81ff">770</span> /var/www/oursamplesite
</span></span></code></pre></div><blockquote>
<p>user havoc will need to log out and then login again for new group permissions to take effect.</p>
</blockquote>
<p>With the required ownership and permissions set, we now proceed to put a sample HTML page there by creating an index.html file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo nano /var/www/oursamplesite/index.html
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">title</span>&gt;Welcome to Our Sample Site&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- The &lt;style&gt; tag is not required, but who doesn&#39;t like a little style--&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#f92672">*</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">box-sizing</span>: <span style="color:#66d9ef">border-box</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">font-family</span>: Arial, Helvetica, <span style="color:#66d9ef">sans-serif</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">body</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">font-family</span>: Arial, Helvetica, <span style="color:#66d9ef">sans-serif</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* Style the top navigation bar */</span>
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">topnav</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">overflow</span>: <span style="color:#66d9ef">hidden</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">background-color</span>: <span style="color:#ae81ff">#333</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* Style the topnav links */</span>
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">topnav</span> <span style="color:#f92672">a</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">float</span>: <span style="color:#66d9ef">left</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">display</span>: <span style="color:#66d9ef">block</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#f2f2f2</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">center</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">14</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">16</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">text-decoration</span>: <span style="color:#66d9ef">none</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* Change color on hover */</span>
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">topnav</span> <span style="color:#f92672">a</span>:<span style="color:#a6e22e">hover</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">background-color</span>: <span style="color:#ae81ff">#ddd</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">black</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* Style the content */</span>
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">content</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">background-color</span>: <span style="color:#ae81ff">#ddd</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">200</span><span style="color:#66d9ef">px</span>; <span style="color:#75715e">/* Should be removed. Only for demonstration */</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* Style the footer */</span>
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">footer</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">background-color</span>: <span style="color:#ae81ff">#f1f1f1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">padding</span>: <span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">style</span>&gt;    
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;content&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">h2</span>&gt;Welcome to Our Sample Site&lt;/<span style="color:#f92672">h2</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">p</span>&gt;This is a sample HTML page for the Our Sample Site.&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;footer&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">p</span>&gt;Page footer&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>We now have to configure our apache virtualhost config to serve our site&rsquo;s content. We do this by creating a file oursamplesite.conf in the <code>/etc/apache2/sites-available/</code> directory.</p>
<p><code>sudo nano /etc/apache2/sites-available/oursamplesite.conf</code> and put the following content in it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&lt;VirtualHost *:80&gt;
</span></span><span style="display:flex;"><span>    ServerName oursamplesite
</span></span><span style="display:flex;"><span>    DocumentRoot /var/www/oursamplesite
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;Directory /var/www/oursamplesite&gt;
</span></span><span style="display:flex;"><span>        Options Indexes FollowSymLinks
</span></span><span style="display:flex;"><span>        AllowOverride All
</span></span><span style="display:flex;"><span>        Require all granted
</span></span><span style="display:flex;"><span>    &lt;/Directory&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ErrorLog ${APACHE_LOG_DIR}/oursamplesite_error.log
</span></span><span style="display:flex;"><span>    CustomLog ${APACHE_LOG_DIR}/oursample_access.log combined
</span></span><span style="display:flex;"><span>&lt;/VirtualHost&gt;
</span></span></code></pre></div><p>We can check for any errors in the config file with <code>sudo apachectl -t</code>. If our config file has no errors, we will get the message <strong>Syntax OK</strong>.</p>
<p>Enable the site with <code>sudo a2ensite oursamplesite.conf</code>.</p>
<p>Disable the default apache2 landing page with <code>sudo a2dissite 000-default.conf</code>.</p>
<p>Restart apache with <code>sudo systemctl restart apache2</code>.</p>
<p>Verify that the new site is up and running by going to <code>https://server-ip</code>.</p>
<p>
<a href="/images/our-sample-site_2023-07-31_10-42.png" data-featherlight="image">
<img src="/images/our-sample-site_2023-07-31_10-42.png" alt="Our Sample Site" style="height: auto; width: auto;" loading="lazy">
</a></p>
<p>If we have firewall enabled on our server, we will configure it to open port 80 with <code>sudo ufw allow &quot;WWWW&quot;</code>. For IPTABLES, the equivalent command is <code>iptables -I INPUT -p tcp --dport 80 -j ACCEPT</code> and for firewalld. it would be:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>firewall-cmd --add-port<span style="color:#f92672">=</span>80/tcp --permanent
</span></span><span style="display:flex;"><span>firewall-cmd --reload
</span></span></code></pre></div><h4 id="configure-apache-with-https">Configure Apache with https</h4>
<h5 id="generate-ssltls-certificates">Generate SSL/TLS certificates</h5>
<p>We will use self signed certificates since we are running the web server in our local network. If we have to expose our site to the internet, there are ways to do this with <strong>NGINX Reverse Proxy</strong> or <strong>Cloudflare tunnels</strong>.</p>
<h5 id="generate-a-private-key">Generate a private key</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo mkdir /etc/ssl/oursamplesite
</span></span><span style="display:flex;"><span>sudo openssl genrsa -out /etc/ssl/oursamplesite/oursamplesite-private.key <span style="color:#ae81ff">4096</span>
</span></span></code></pre></div><h5 id="generate-csr-certificate-signing-request">Generate CSR (Certificate Signing Request)</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo openssl req -new -key /etc/ssl/oursamplesite/oursamplesite-private.key <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-out /etc/ssl/oursamplesite/oursamplesite-csr.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-subj <span style="color:#e6db74">&#34;/C=US/ST=CL/L=California/O=OurSampleSite/CN=oursamplesite&#34;</span>
</span></span></code></pre></div><p>Of these parameters above, the most important one is <strong>CN=oursamplesite</strong>. Please ensure that you edit it to whatever is the domain name you want to use.</p>
<h5 id="generate-the-ssltls-certificate">Generate the SSL/TLS certificate</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo openssl x509 -req -days <span style="color:#ae81ff">3650</span> -in /etc/ssl/oursamplesite/oursamplesite-csr.pem <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-signkey  /etc/ssl/oursamplesite/oursamplesite-private.key -out /etc/ssl/oursamplesite/oursamplesite-cert.crt
</span></span></code></pre></div><p>After executing these commands (use <strong>sudo</strong> with these commands unless you are running as root), we will have the following files in our <code>/etc/ssl/oursamplesite</code> directory.</p>
<p>
<a href="/images/ssl_files_listing_2023-07-31_10-49.png" data-featherlight="image">
<img src="/images/ssl_files_listing_2023-07-31_10-49.png" alt="Certificate File Listing" style="height: auto; width: auto;" loading="lazy">
</a></p>
<h5 id="installenable-apache-ssl-modules">Install/Enable Apache SSL modules</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo a2enmod ssl
</span></span></code></pre></div><p>
<a href="/images/a2enmod_ssl_2023-07-31_10-53.png" data-featherlight="image">
<img src="/images/a2enmod_ssl_2023-07-31_10-53.png" alt="a2enmod" style="height: auto; width: auto;" loading="lazy">
</a></p>
<p>Confirm with <code>apachectl -M | grep ssl</code>. You should get an output <strong>ssl_module (shared)</strong> if all is well.</p>
<p>
<a href="/images/ssl_module_2023-07-31_10-56.png" data-featherlight="image">
<img src="/images/ssl_module_2023-07-31_10-56.png" alt="ssl_module" style="height: auto; width: auto;" loading="lazy">
</a></p>
<h5 id="update-config-to-use-ssltls">Update config to use SSL/TLS</h5>
<p>Edit the file we created earlier, <code>/etc/apache2/sites-available/oursamplesite.conf</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&lt;VirtualHost *:80&gt;
</span></span><span style="display:flex;"><span>    ServerName oursamplesite
</span></span><span style="display:flex;"><span>    Redirect permanent / https://192.168.0.97/
</span></span><span style="display:flex;"><span>    #DocumentRoot /var/www/oursamplesite
</span></span><span style="display:flex;"><span>&lt;/VirtualHost&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;VirtualHost *:443&gt;
</span></span><span style="display:flex;"><span>    ServerName oursamplesite
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    SSLEngine on
</span></span><span style="display:flex;"><span>    SSLCertificateFile /etc/ssl/oursamplesite/oursamplesite-cert.crt
</span></span><span style="display:flex;"><span>    SSLCertificateKeyFile /etc/ssl/oursamplesite/oursamplesite-private.key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    DocumentRoot /var/www/oursamplesite
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;Directory /var/www/oursamplesite&gt;
</span></span><span style="display:flex;"><span>        Options Indexes FollowSymLinks
</span></span><span style="display:flex;"><span>        AllowOverride All
</span></span><span style="display:flex;"><span>        Require all granted
</span></span><span style="display:flex;"><span>    &lt;/Directory&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ErrorLog ${APACHE_LOG_DIR}/oursamplesite_error.log
</span></span><span style="display:flex;"><span>    CustomLog ${APACHE_LOG_DIR}/oursample_access.log combined
</span></span><span style="display:flex;"><span>&lt;/VirtualHost&gt;
</span></span></code></pre></div><h5 id="enable-apache-rewrite-modules">Enable apache rewrite modules</h5>
<p><code>sudo a2enmod rewrite</code>, check for errors with <code>sudo apachectl -t</code> and restart apache2 with <code>sudo systemctl restart apache2</code></p>
<p>If required, update firewall rules with the following commands as applicable</p>
<p><code>ufw allow &quot;WWW Secure&quot;</code></p>
<p><code>iptables -I INPUT -p tcp --dport 443 -j ACCEPT</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>firewall-cmd --add-port<span style="color:#f92672">=</span>443/tcp --permanent
</span></span><span style="display:flex;"><span>firewall-cmd --reload
</span></span></code></pre></div><p>That&rsquo;s it. The self signed certificate we generated will however not be trusted by the browser and you will need to add an exception when your browser of choice displays a warning to that effect.</p>
<p>You can now navigate to <code>https://server_ip</code> to access our site. Even if we use HTTP to navigate to our site, the <strong>Redirect</strong> statment in our config file will redirect the connection to HTTPS.</p>
<p>
<a href="/images/https_enabled_site_2023-07-31_11-45.png" data-featherlight="image">
<img src="/images/https_enabled_site_2023-07-31_11-45.png" alt="HTTPS Enabled" style="height: auto; width: auto;" loading="lazy">
</a></p>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
<h1 id="encrypt-and-share-files-with-gpg">Encrypt and Share Files With Gpg</h1>

<p>
<a href="/images/public_key_encryption2023-07-31_13-07.png" data-featherlight="image">
<img src="/images/public_key_encryption2023-07-31_13-07.png" alt="PKE" style="height: auto; width: auto;" loading="lazy">
</a></p>
<p>Today, we will look at encrypting and sharing files securely using <strong>gpg</strong>. GnuPG (GPG) is a tool used to encrypt data and create digital signatures.</p>
<p>For our exercise, we will consider two users on two different linux systems. They are running a mustard smuggling operations out of an undisclosed location and need to share information securely, to avoid any interception by Mustardpol. 😉</p>
<p>User1 : sierra1 with email <a href="mailto:sierra1@mustardops.org">sierra1@mustardops.org</a>
User2 : november2 with email <a href="mailto:november2@mustardops.org">november2@mustardops.org</a></p>
<p>The workflow goes as follows:</p>
<p>sierra1 wants to send details of the next shipment of mustard to november2. Both these guys needs to create their own key pairs (public and private) on their respecive systems. Once the key pairs have been generated, they will share their repective public keys with each other. (<em>We will assume that they can do so by using rsync</em>). Sharing public keys can be done via open communication channels like email, but there should be a mechanism by which you have the <strong>assurance</strong> that the public key does belong to the person with whom you wish to share information with.</p>
<p>The private keys, however should never be shared and should be stored securely.</p>
<p>User1 and User2 generates their own key pairs with the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gpg --full-generate-key
</span></span></code></pre></div><p>They answer the prompts generated by gpg and end up with their key pair. We can list our key pairs with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gpg --list-public-keys
</span></span><span style="display:flex;"><span>gpg --list-secret-keys <span style="color:#75715e"># displays the private keys</span>
</span></span></code></pre></div><p>Public Key Listing (User1)

<a href="/images/sierra1_gpg_key_listing_2023-07-26_12-54.png" data-featherlight="image">
<img src="/images/sierra1_gpg_key_listing_2023-07-26_12-54.png" alt="Sierra1 GPG Key Listing" style="height: auto; width: auto;" loading="lazy">
</a></p>
<p>Private Key Listing (User1)</p>
<p>
<a href="/images/sierra1_gpg_rpivate_key_listing_2023-07-26_12-54.png" data-featherlight="image">
<img src="/images/sierra1_gpg_rpivate_key_listing_2023-07-26_12-54.png" alt="Sierra1 Private Key Listing" style="height: auto; width: auto;" loading="lazy">
</a></p>
<p>The same comands as above will be executed by User2, substituting the name and email address parameters.</p>
<p>Public Ket Listing (User2)</p>
<p>
<a href="/images/november2_gpg_public_key_2023-07-26_17-19.png" data-featherlight="image">
<img src="/images/november2_gpg_public_key_2023-07-26_17-19.png" alt="Public Key User2" style="height: auto; width: auto;" loading="lazy">
</a></p>
<p>Private Key Listing (User2)</p>
<p>
<a href="/images/user2_private_key_listing_2023-07-26_17-21.png" data-featherlight="image">
<img src="/images/user2_private_key_listing_2023-07-26_17-21.png" alt="User2 Private Key Listing" style="height: auto; width: auto;" loading="lazy">
</a></p>
<p>They will now need to export their public keys into a file and share those with each other. This is done with the fillowing command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gpg --export -o sierra1.key 68A14F32098A4698C1DF53C631E2FFFE296EA030
</span></span><span style="display:flex;"><span><span style="color:#75715e"># the last paramater is the key ID which is displayed when we list the kseys with the -list-keys option above</span>
</span></span></code></pre></div><p>Now that they have shared their public keys with each other, they need to import the public keys into their respective system&rsquo;s public keyring with the following command.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gpg --import sierra1.key <span style="color:#75715e"># User2 will execute this command on his system</span>
</span></span><span style="display:flex;"><span>gpg --import november2.key <span style="color:#75715e">## User1 will execute this command on his system</span>
</span></span></code></pre></div><p>The next step will be encrypting files and sending them to the recipeint. Lets say that User1 want to send a text file <code>mustard_shipments.txt</code> to User2. He will do so with the follwing command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gpg -e -r november2@mustardops.org mustard_shipments.txt
</span></span></code></pre></div><p>This command will create a file named <code>mustard_shipments.txt.gpg</code>, which can be send to the recipient. The recipient can now decrypt the file with the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gpg -d mustard_shipments.txt.gpg
</span></span><span style="display:flex;"><span><span style="color:#75715e">## store the decrypted data in shipment.txt</span>
</span></span><span style="display:flex;"><span>gpg -d -o shipment.txt  mustard_shipments.txt.gpg
</span></span></code></pre></div><p>We can use <strong>gpg</strong> to encrypt a file with <code>gpg -c file_to_be_encrypted.txt</code>. You will be prompted for a password during the encryption process. This command will create an encrypted file named <code>file_to_be_encrypted.txt.gpg</code>.</p>
<p>⚠️ <em>If the file you are encrypting contains really sensitive data, you should erase the original file securely once it hs been encrypted</em>.</p>
<p>To decrypt the file use <code>gpg -d file_to_be_encrypted.txt.gpg</code></p>
<p>You can delete a user&rsquo;s GPG Keys from your system with the following command(s):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gpg --delete-secret-key november2@mustardops.org
</span></span><span style="display:flex;"><span>pg --delete-key november2@mustardops.org
</span></span></code></pre></div><hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="default">
<h1 id="secure-passwords-in-linux">Secure Passwords in Linux</h1>

<p>There are many utilities in Linux that help us in generating random passwords. The neccessity of having a strong password is well known. The problem with random passwords is that it is nearly impossible for us remember them. Using a password manager like <strong>KeePassX</strong> or <strong>KeePass2</strong>. That way, you only have to remember one password, the <strong>master pasword</strong> to unlock your password vault. This leads to another monkey&rsquo;s tail scenario. If we loose/forget the master password, we you&rsquo;re doomed.</p>
<p>
		
<a href="/images/forgot_password.avif?height=300px" data-featherlight="image">
<img src="/images/forgot_password.avif?height=300px" alt="Forgot Password" style="height: 300px; width: auto;" loading="lazy">
</a></p>
<h4 id="utilities-you-can-use">Utilities you can use</h4>
<h5 id="openssl">OpenSSL</h5>
<p>You can use OpenSSL to generate a random password for you with the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>    openssl rand -base64 <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># This command will generate a random 20 character long password as shown below.</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>XAOuOA3ZE+RnHxHqo8tAJgT0p8k=
</span></span></code></pre></div><h5 id="urandom">Urandom</h5>
<p>We can generate randomg passwords with <code>/dev/urandom</code> like so</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo &lt; /dev/urandom tr -dc A-Za-z0-9 | head -c20; echo
</span></span><span style="display:flex;"><span><span style="color:#75715e"># here we are using the alphanumeric charset with a length of 20 chars</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>PsZo8QTxYwv5aoc2rxR1
</span></span></code></pre></div><h5 id="pwgen">pwgen</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>pwgen -ysBv <span style="color:#ae81ff">20</span> -n1
</span></span><span style="display:flex;"><span><span style="color:#75715e"># we are geerating a 20 character long password. alter the -n parameter to generate more passwords</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>9h$FR{v/*7.z$/$9zfx-
</span></span></code></pre></div><h5 id="gpg">gpg</h5>
<p>We can generate random secure passwords with gpg using the following command. We will specify s length of 20 chars.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gpg --gen-random --armor <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># this command will generate a secure, random base64 encoded apssword</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>B0nKqkHe/lJnu0Z6npYxvUILgYw=
</span></span></code></pre></div><h5 id="sha-secure-hashing-algorithm">SHA (Secure Hashing Algorithm)</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>date +%s | sha256sum | base64 | head -c <span style="color:#ae81ff">20</span> ; echo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>OWE3ZjY3YjY0MjZiZDVi
</span></span></code></pre></div><h5 id="md5">md5</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>date | md5sum
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>b796eaba55e90433a3f8041203b338b4
</span></span></code></pre></div><h5 id="xkcdpass">xkcdpass</h5>
<p>xkcdpass is not installed by default, (atleast on Debian 12 on which I&rsquo;m running these commands.) it can be installed via <code>apt install kkcdpass</code>. This proram will generate a list of words which you could use as your passphrase.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>havoc@trident:~$ xkcdpass 
</span></span><span style="display:flex;"><span>palpitate arguable popper renegade eclipse boned
</span></span></code></pre></div><h5 id="diceware">diceware</h5>
<p>diceware functions in a manner similar to xkcdpass.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>havoc@trident:~$ diceware 
</span></span><span style="display:flex;"><span>AmbushUnworldlyUnmadePoachCofounderDisown
</span></span></code></pre></div><p>you can specify the wordlist to use with the <code>--wordlist</code> parameter like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>havoc@trident:~$ diceware --wordlist en_eff
</span></span><span style="display:flex;"><span>FitHungerTrillionLevelDrinkableJarring
</span></span></code></pre></div><p>Use any of these utilities to generate your passwords. You could use a passwords manager to store these passwords. Keepass2 has an inbuilt password manager you can use to generate passwords. ⚠️<em>Pick your poison, stay safe online</em>. Whereever possible, use <strong>2FA</strong> (Two Factor Authentication). Store your backup codes (<em>yes, you can download your backp codes for your online services, which can be used when you don&rsquo;t access to your 2FA devices. I once lost access to my dropbox because I didnt have my backup codes 😢</em>) in a secure location and manner.</p>
<p>
		
<a href="/images/stay-safe-online-or-you-will-look-like-me.png?height=300px" data-featherlight="image">
<img src="/images/stay-safe-online-or-you-will-look-like-me.png?height=300px" alt="Stay Safe Online" style="height: 300px; width: auto;" loading="lazy">
</a></p>

            <footer class="footline">
            </footer>
          </article>

          </section>        </div>
      </main>
    </div>
    <script src="/js/clipboard.min.js?1690804204" defer></script>
    <script src="/js/perfect-scrollbar.min.js?1690804204" defer></script>
    <script src="/js/featherlight.min.js?1690804204" defer></script>
    <script src="/js/theme.js?1690804204" defer></script>
  </body>
</html>
