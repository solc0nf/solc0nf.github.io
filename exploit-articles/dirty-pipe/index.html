<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.108.0">
    <meta name="generator" content="Relearn 5.9.4+tip">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="Exploit writeups, info sec articles..">
    <meta name="author" content="solc0nf">
    <title>Dirty Pipe :: solc0nf</title>
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/css/fontawesome-all.min.css?1690802202" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fontawesome-all.min.css?1690802202" rel="stylesheet"></noscript>
    <link href="/css/featherlight.min.css?1690802202" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/featherlight.min.css?1690802202" rel="stylesheet"></noscript>
    <link href="/css/auto-complete.css?1690802202" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/auto-complete.css?1690802202" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar.min.css?1690802202" rel="stylesheet">
    <link href="/css/nucleus.css?1690802202" rel="stylesheet">
    <link href="/css/fonts.css?1690802202" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fonts.css?1690802202" rel="stylesheet"></noscript>
    <link href="/css/theme.css?1690802202" rel="stylesheet">
    <link href="/css/theme-relearn-dark.css?1690802202" rel="stylesheet" id="variant-style">
    <link href="/css/ie.css?1690802202" rel="stylesheet">
    <link href="/css/variant.css?1690802202" rel="stylesheet">
    <link href="/css/print.css?1690802202" rel="stylesheet" media="print">
    <script src="/js/url.js?1690802202"></script>
    <script src="/js/variant.js?1690802202"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="/index.search.js";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/solc0nf.github.io/';
      window.variants && variants.init( [ 'relearn-dark' ] );
    </script>
    <script src="/js/jquery.min.js?1690802202" defer></script>
  </head>
  <body class="mobile-support html disableInlineCopyToClipboard" data-url="/exploit-articles/dirty-pipe/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable" dir="ltr">
        <div>
          <div class="navigation">
            <a class="nav nav-next" href="/exploit-articles/shellshock/index.html" title="ShellShock (&#129106;)"><i class="fas fa-chevron-right fa-fw"></i></a>
          </div>
          <div class="navigation">
            <a class="nav nav-prev" href="/exploit-articles/index.html" title="Exploit Articles (&#129104;)"><i class="fas fa-chevron-left fa-fw"></i></a>
          </div>
          <div id="top-print-link">
            <a class="print-link" title='Print whole chapter (CTRL+ALT+p)' href="/exploit-articles/dirty-pipe/index.print.html">
              <i class="fas fa-print fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/index.html"><span itemprop="name">solc0nf</span></a><meta itemprop="position" content="1"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/exploit-articles/index.html"><span itemprop="name">Exploit Articles</span></a><meta itemprop="position" content="2"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Dirty Pipe</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
<div class="tags">
  <a class="tag-link" href="/tags/exploit/index.html">exploit</a>
  <a class="tag-link" href="/tags/linux/index.html">linux</a>
</div>
          </div>
          <article class="default">
<h1 id="dirty-pipe">Dirty Pipe</h1>

<table>
<thead>
<tr>
<th>Vulnerability</th>
<th>Affected OS</th>
<th>CVE</th>
<th>CVSS Score</th>
<th>Disclosure Date</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dirty Pipe</td>
<td>Linux (kernel versions 5.8 and newer)</td>
<td>CVE-2022-0847</td>
<td>7.8 (high)</td>
<td>March 7 2022</td>
</tr>
</tbody>
</table>
<p>This exploit was disclosed by Max Kellermann.</p>
<p>DirtyPipe is a local privilege escalation vulnerability, which allows a user to bypass file permission restrictions and write arbitrary data to any file, provided certain conditions are met, the primary one being that the user has to have read permissions to the file.</p>
<p>In order to understand this vulnerability, we need to understand the following concepts:</p>
<ul>
<li>pipe</li>
<li>page</li>
<li>splice()</li>
</ul>
<p><em>Pipe</em>: A pipe is a communication method between two or more processes in which the output of one process can be used as the input for the other. An example of a pipe is <code>ls -la | grep Documents</code>. In this example, the output of the ls command (which is a listing of files and directories) is <em>piped</em> into the <code>grep</code> command which in turn, looks for the string <code>Documents</code> in that input and displays the results on screen. Pipes are unidirectional, with a read end and a write end.</p>
<p><em>Page</em>: Memory management in Linux makes use of pages. Whether it is to read from a file on the secondary memory (like the hard drive) or to write to it, pages are used. Memory pages are 4Â KB in size. Whenever data is read from the secondary memory, it is put into the page cache. Likewise, when data is to be written to the disk, it is placed in the page cache and eventually written to the disk. This setup eliminates the need to expensive read-write operations to the disk. Since main memory is way faster than secondary memory, this scheme helps performance. One point that is of relevance when talking about this vulnerability is the <em>PIPE_BUF_FLAG_CAN_MERGE</em> flag, which indicates whether merging more data into the pipe is allowed or not.</p>
<p><em>splice()</em>: is a system call (a system call is a way through which a process requests a service from the operating system) which moves data between a file descriptor and a pipe, without copying between kernel address space and user address space. The pipe doesn&rsquo;t actually contain the data itself, but a reference to the location of the page cache in memory, where the data is stored.</p>
<p>The way this vulnerability is exploited is as follows:</p>
<ul>
<li>Read the target file. This will cause the file to be placed in the page cache.</li>
<li>Create a pipe in a special way so that the PIPE_BUF_FLAG_CAN_MERGE is set.</li>
<li>Use the splice() system call to make the pipe point to the locations of the page cache where the data is cached.</li>
<li>Write arbitrary data into the pipe. The data so written will overwrite the cached page file and since the PIPE_BUF_FLAG_CAN_MERGE is set, it overwrites the file on the disk.</li>
</ul>
<p>Exploit code available on <a href="https://www.exploit-db.com/exploits/50808" target="_blank">exploit-db.com</a></p>
<p>The blog post by Max Kellermann about this exploit linked <a href="https://dirtypipe.cm4all.com/" target="_blank">here</a> is a fascinating read.</p>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    <aside id="sidebar" class="default-animation showVisitedLinks" dir="ltr">
      <div id="header-wrapper" class="default-animation">
        <div id="header" class="default-animation">
<img src="/solconf.png"></img>
<h6>Solc0nf Systems</h6>
        </div>
        <form action="/search.html" method="get"><div class="searchbox default-animation">
          <button type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
          <label class="a11y-only" for="search-by">Search</label>
          <input data-search-input id="search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
          <span data-search-clear=""><i class="fas fa-times"></i></span>
        </div></form>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="/js/auto-complete.js?1690802202" defer></script>
        <script src="/js/lunr/lunr.min.js?1690802202" defer></script>
        <script src="/js/lunr/lunr.stemmer.support.min.js?1690802202" defer></script>
        <script src="/js/lunr/lunr.multi.min.js?1690802202" defer></script>
        <script src="/js/lunr/lunr.en.min.js?1690802202" defer></script>
        <script src="/js/search.js?1690802202" defer></script>
      </div>
      <div id="homelinks" class="default-animation">
        <ul>
          <li><a class="padding" href="/index.html"><i class="fas fa-home"></i> Home</a></li>
        </ul>
      </div>
      <div id="content-wrapper" class="highlightable">
        <ul class="topics collapsible-menu">
          <li data-nav-id="/exploit-articles/index.html" class="dd-item parent"><input type="checkbox" id="section-3b4d423a3ed6a06d19aa7b4fd218b430" aria-controls="subsections-3b4d423a3ed6a06d19aa7b4fd218b430" class="toggle" checked><label class="a11y-only toggle" for="section-3b4d423a3ed6a06d19aa7b4fd218b430" >Submenu Exploit Articles</label><a href="/exploit-articles/index.html">Exploit Articles<i class="fas fa-check read-icon"></i></a><ul id="subsections-3b4d423a3ed6a06d19aa7b4fd218b430">
          <li data-nav-id="/exploit-articles/dirty-pipe/index.html" class="dd-item active"><a href="/exploit-articles/dirty-pipe/index.html">Dirty Pipe<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/exploit-articles/shellshock/index.html" class="dd-item"><a href="/exploit-articles/shellshock/index.html">ShellShock<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/exploit-articles/samba-trans2open-exploit/index.html" class="dd-item"><a href="/exploit-articles/samba-trans2open-exploit/index.html">Samba Trans2open Exploit<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/exploit-articles/the-dirtycow-exploit/index.html" class="dd-item"><a href="/exploit-articles/the-dirtycow-exploit/index.html">The Dirtycow Exploit<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/exploit-articles/eternal-blue/index.html" class="dd-item"><a href="/exploit-articles/eternal-blue/index.html">Eternal Blue<i class="fas fa-check read-icon"></i></a></li></ul></li>
          <li data-nav-id="/linux-howto/index.html" class="dd-item"><input type="checkbox" id="section-2d4257959db23532f0d2a8f029bc3b96" aria-controls="subsections-2d4257959db23532f0d2a8f029bc3b96" class="toggle"><label class="a11y-only toggle" for="section-2d4257959db23532f0d2a8f029bc3b96" >Submenu Linux How To</label><a href="/linux-howto/index.html">Linux How To<i class="fas fa-check read-icon"></i></a><ul id="subsections-2d4257959db23532f0d2a8f029bc3b96">
          <li data-nav-id="/linux-howto/apache2-custom-site-with-self-signed-certificate/index.html" class="dd-item"><a href="/linux-howto/apache2-custom-site-with-self-signed-certificate/index.html">Apache2 Custom Site With Self Signed Certificate<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/linux-howto/encrypt-and-share-files-with-gpg/index.html" class="dd-item"><a href="/linux-howto/encrypt-and-share-files-with-gpg/index.html">Encrypt and Share Files With Gpg<i class="fas fa-check read-icon"></i></a></li>
          <li data-nav-id="/linux-howto/secure-passwords-in-linux/index.html" class="dd-item"><a href="/linux-howto/secure-passwords-in-linux/index.html">Secure Passwords in Linux<i class="fas fa-check read-icon"></i></a></li></ul></li>
        </ul>
        <div id="shortcuts">
          <div class="nav-title">More</div>
          <ul>
            <li><a class="padding" href="/tags/index.html"><i class='fas fa-tags'></i> Tags</a></li>
          </ul>
        </div>
        <div class="footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter"></div>
        <hr class="default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter">
        <div id="prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks showVisitedLinks">
          <ul>
            <li id="select-language-container" class="footerLangSwitch">
              <div class="padding select-container">
                <i class="fas fa-language fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <label class="a11y-only" for="select-language">Language</label>
                  <select id="select-language" onchange="location = baseUri + this.value;">
                  </select>
                </div>
                <div class="select-clear"></div>
              </div>
            </li>
            <li id="select-variant-container" class="footerVariantSwitch">
              <div class="padding select-container">
                <i class="fas fa-paint-brush fa-fw"></i>
                <span>&nbsp;</span>
                <div class="select-style">
                  <label class="a11y-only" for="select-variant">Theme</label>
                  <select id="select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                    <option id="relearn-dark" value="relearn-dark" selected>Relearn Dark</option>
                  </select>
                </div>
                <div class="select-clear"></div>
              </div>
              <script>window.variants && variants.markSelectedVariant();</script>
            </li>
            <li class="footerVisitedLinks showVisitedLinks"><button class="padding" onclick="clearHistory();"><i class="fas fa-history fa-fw"></i> Clear History</button></li>
          </ul>
        </div>
        <div id="footer" class="footerFooter showFooter">
	    <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
        </div>
      </div>
    </aside>
    <script src="/js/clipboard.min.js?1690802202" defer></script>
    <script src="/js/perfect-scrollbar.min.js?1690802202" defer></script>
    <script src="/js/featherlight.min.js?1690802202" defer></script>
    <script src="/js/theme.js?1690802202" defer></script>
  </body>
</html>
